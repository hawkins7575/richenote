import{j as e,C as g,a as Z,b as ee,c as u,u as se,d as te,B as ae}from"./index-NWa438vT.js";import{r as i,e as le}from"./react-vendor-DS3Z5Hf_.js";import{u as re,a as ne}from"./useProperties-CAHvE_p5.js";import{i as $,f as b,j as ie,T as A,U as O,b as ce,k as oe,H as de,l as me,g as xe}from"./ui-vendor-DnkZPEX2.js";import{P as he,a as ge,b as pe}from"./PropertyEditForm-_hUDANX9.js";import{g as ue}from"./teamService-B14ur8LT.js";import{s as U}from"./scheduleService-B9XGONvY.js";import"./supabase-vendor-CCigGT7m.js";import"./utils-vendor-BJeS7sC5.js";import"./useMobileDetection-BYhEgXwQ.js";const je=i.memo(({title:m,value:a,change:r,icon:d,color:c="text-gray-600",loading:x=!1})=>e.jsxs(g,{className:"transition-all hover:shadow-md",children:[e.jsxs(Z,{className:"flex flex-row items-center justify-between space-y-0 pb-2 px-3 sm:px-6 pt-3 sm:pt-6",children:[e.jsx(ee,{className:"text-xs sm:text-sm font-medium text-gray-600 truncate pr-2",children:m}),e.jsx(d,{className:`h-3 w-3 sm:h-4 sm:w-4 ${c} flex-shrink-0`})]}),e.jsx(u,{className:"px-3 sm:px-6 pb-3 sm:pb-6",children:x?e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 sm:h-8 bg-gray-200 rounded w-3/4 mb-1 sm:mb-2"}),e.jsx("div",{className:"h-3 sm:h-4 bg-gray-200 rounded w-1/2"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-lg sm:text-2xl font-bold text-gray-900 leading-none",children:a}),r&&e.jsxs("p",{className:"text-xs sm:text-xs text-gray-500 mt-1 leading-none",children:[e.jsxs("span",{className:"hidden sm:inline",children:[r," 지난달 대비"]}),e.jsx("span",{className:"sm:hidden",children:r})]})]})})]})),F=({title:m,schedules:a,loading:r,emptyMessage:d,onViewAll:c})=>{const x={property_viewing:{label:"매물 보기",color:"bg-blue-500",icon:e.jsx(oe,{className:"w-3 h-3"})},contract_signing:{label:"계약 체결",color:"bg-green-500",icon:e.jsx(A,{className:"w-3 h-3"})},maintenance:{label:"유지보수",color:"bg-yellow-500",icon:e.jsx(ce,{className:"w-3 h-3"})},client_meeting:{label:"고객 미팅",color:"bg-purple-500",icon:e.jsx(O,{className:"w-3 h-3"})},team_meeting:{label:"팀 회의",color:"bg-indigo-500",icon:e.jsx(O,{className:"w-3 h-3"})},personal:{label:"개인 일정",color:"bg-pink-500",icon:e.jsx(b,{className:"w-3 h-3"})},other:{label:"기타",color:"bg-gray-500",icon:e.jsx(A,{className:"w-3 h-3"})}},j=(t,l)=>{const o=new Date(t);return l?"종일":o.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit",hour12:!1})},y=t=>{const l=new Date(t),o=new Date,p=new Date(o);return p.setDate(o.getDate()+1),l.toDateString()===o.toDateString()?"오늘":l.toDateString()===p.toDateString()?"내일":l.toLocaleDateString("ko-KR",{month:"short",day:"numeric"})},v=(t,l=25)=>t.length>l?`${t.slice(0,l)}...`:t;return r?e.jsx(g,{children:e.jsxs(u,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:m}),c&&e.jsxs("button",{className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:["더보기",e.jsx($,{className:"w-4 h-4 ml-1"})]})]}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex items-center space-x-3 animate-pulse",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-200"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-12"})]},t))})]})}):e.jsx(g,{children:e.jsxs(u,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:m}),c&&e.jsxs("button",{onClick:c,className:"text-sm text-blue-600 hover:text-blue-800 flex items-center transition-colors",children:["더보기",e.jsx($,{className:"w-4 h-4 ml-1"})]})]}),a.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(b,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500 text-sm",children:d})]}):e.jsx("div",{className:"space-y-3",children:a.map(t=>{const l=x[t.category];return e.jsxs("div",{className:"flex items-center justify-between p-2 sm:p-3 hover:bg-gray-50 rounded-lg transition-colors cursor-pointer border border-transparent hover:border-gray-200 group",title:`${t.title} - ${l.label}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${l.color} flex-shrink-0`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:v(t.title)}),t.priority==="urgent"&&e.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-red-100 text-red-600",children:"긴급"})]}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:l.label}),t.location&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-300 hidden sm:inline",children:"•"}),e.jsx("span",{className:"text-xs text-gray-400 truncate max-w-16 sm:max-w-24",children:t.location})]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end text-right flex-shrink-0 ml-2 sm:ml-3",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-600",children:[e.jsx(ie,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:j(t.start_date,t.all_day)}),e.jsx("span",{className:"sm:hidden",children:t.all_day?"종일":j(t.start_date,t.all_day).slice(0,5)})]}),e.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:y(t.start_date)})]})]},t.id)})})]})})},Te=()=>{const m=le(),{tenant:a}=se(),{user:r}=te(),{stats:d,loading:c,error:x}=re(),{properties:j,loading:y,updateProperty:v,deleteProperty:t,refreshProperties:l}=ne(),[o,p]=i.useState(1),[R,P]=i.useState(!0),[B,T]=i.useState([]),[H,_]=i.useState([]),[k,E]=i.useState(!0),[I,w]=i.useState(null),[K,f]=i.useState(!1),[z,S]=i.useState(!1),[G,M]=i.useState(!1),[N,C]=i.useState(null);i.useEffect(()=>{(async()=>{if(r?.id)try{P(!0);const n=await ue(r.id);p(n.length)}catch{p(1)}finally{P(!1)}})()},[r?.id]),i.useEffect(()=>{(async()=>{if(r?.id)try{E(!0);const n=r.id,[h,D]=await Promise.all([U.getTodaySchedules(n,3),U.getUpcomingSchedules(n,3)]);T(h),_(D)}catch{T([]),_([])}finally{E(!1)}})()},[r?.id]);const L=()=>{m("/schedule")},V=s=>{w(s),f(!0)},q=()=>{f(!1),w(null)},J=async s=>{if(N)try{M(!0),await v(N.id,s),S(!1),C(null),await l(),alert("✅ 매물이 성공적으로 수정되었습니다!")}catch(n){const h=n instanceof Error?n.message:"알 수 없는 오류가 발생했습니다.";throw alert(`❌ 매물 수정 실패: ${h}`),n}finally{M(!1)}},Q=s=>{C(s),S(!0),f(!1)},W=async s=>{if(window.confirm(`'${s.title}' 매물을 정말 삭제하시겠습니까?

이 작업은 되돌릴 수 없습니다.`))try{await t(s.id),f(!1),w(null),await l(),alert("✅ 매물이 성공적으로 삭제되었습니다!")}catch(h){const D=h instanceof Error?h.message:"알 수 없는 오류가 발생했습니다.";alert(`❌ 매물 삭제 실패: ${D}`)}},X=[{title:"총 매물",value:(d?.total??0).toString(),change:"+12%",icon:de,color:"text-blue-600"},{title:"활성 매물",value:(d?.active??0).toString(),change:"+5%",icon:me,color:"text-green-600"},{title:"팀원",value:o.toString(),change:o>1?`+${o-1}`:"0",icon:xe,color:"text-purple-600"},{title:"이번 달 등록",value:(d?.this_month??0).toString(),change:"+18%",icon:b,color:"text-orange-600"}],Y=[{id:1,title:"강남구 신사동 럭셔리 아파트",type:"아파트",transactionType:"매매",price:"35억",createdAt:"2시간 전"},{id:2,title:"성남시 분당구 정자동",type:"아파트",transactionType:"전세",price:"2억 1천만원",createdAt:"5시간 전"},{id:3,title:"홍대 신축 오피스텔",type:"오피스텔",transactionType:"월세",price:"1000/65만원",createdAt:"1일 전"}];return y||c?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6 pb-20 sm:pb-6",children:[e.jsxs("div",{className:"px-1 sm:px-0",children:[e.jsxs("h1",{className:"text-lg sm:text-2xl font-bold leading-tight",children:["안녕하세요, ",r?.name||"사용자","님! 👋"]}),e.jsx("h2",{className:"text-sm sm:text-base text-gray-600 mt-1 lg:hidden",children:a?.name||"리체 매물장"}),e.jsxs("h2",{className:"hidden lg:block text-2xl font-bold mt-1",children:[a?.name||"리체 매물장","에 오신 것을 환영합니다 👋"]}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"오늘의 매물 현황을 확인해보세요"})]}),c?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 lg:gap-6",children:[1,2,3,4].map(s=>e.jsx(g,{className:"animate-pulse",children:e.jsx(u,{className:"p-3 sm:p-4 lg:p-6",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("div",{className:"h-3 sm:h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-6 sm:h-8 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/3 hidden sm:block"})]})})},s))}):x?e.jsx(g,{className:"p-4 sm:p-6",children:e.jsx("p",{className:"text-red-600 text-center text-sm sm:text-base",children:x})}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 lg:gap-6",children:X.map((s,n)=>e.jsx(je,{title:s.title,value:s.value,change:s.change,icon:s.icon,color:s.color,loading:s.title==="팀원"?R:c},n))}),e.jsx("div",{className:"space-y-4 lg:space-y-6",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx(b,{className:"w-5 h-5 mr-2 text-blue-600"}),"일정 관리"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6",children:[e.jsx(F,{title:"오늘 일정",schedules:B,loading:k,emptyMessage:"오늘 등록된 일정이 없습니다.",onViewAll:L}),e.jsx(F,{title:"다가올 일정",schedules:H,loading:k,emptyMessage:"예정된 일정이 없습니다.",onViewAll:L})]})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"최근 등록 매물"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:j?.slice(0,4).map(s=>e.jsx(he,{property:s,onClick:V},s.id))||Y.map(s=>e.jsxs("div",{className:"card bg-white rounded-xl border border-gray-200 hover:border-blue-300 hover:shadow-md transition-all duration-200 cursor-pointer p-4 space-y-3",onClick:()=>{},children:[e.jsx("h3",{className:"font-semibold text-lg line-clamp-1",children:s.title}),e.jsx("div",{className:"flex items-center text-gray-600",children:e.jsx("span",{className:"text-sm",children:"강남구"})}),e.jsx("div",{className:"flex items-center text-gray-900",children:e.jsx("span",{className:"font-bold text-lg",children:s.price})}),e.jsxs("div",{className:"border-t border-gray-100 pt-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:s.type}),e.jsx("span",{className:"text-gray-300",children:"•"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.transactionType})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full mr-2 bg-blue-400"}),e.jsx("span",{className:"text-xs font-medium text-blue-600",children:"등록됨"})]})]})]},s.id))})]})}),a&&e.jsx(g,{className:"bg-gradient-to-r from-primary-50 to-blue-50 border-primary-200",children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[a.plan?a.plan.charAt(0).toUpperCase()+a.plan.slice(1):"기본"," ","플랜"]}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["매물 ",a.limits.max_properties,"개 · 팀원"," ",a.limits.max_users,"명 · 스토리지"," ",a.limits.max_storage_gb,"GB"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(ae,{variant:"tenant",size:"lg",children:a.status==="trial"?"체험 중":"활성"}),a.trial_ends_at&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["체험 종료:"," ",new Date(a.trial_ends_at).toLocaleDateString()]})]})]})})}),e.jsx(ge,{property:I,isOpen:K,onClose:q,onEdit:Q,onDelete:W}),N&&e.jsx(pe,{isOpen:z,onClose:()=>{S(!1),C(null)},onSubmit:J,property:N,loading:G})]})};export{Te as DashboardPage};
